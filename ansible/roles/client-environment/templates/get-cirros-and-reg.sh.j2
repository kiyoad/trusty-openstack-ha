#!/bin/bash
set -eux
export OS_PROJECT_DOMAIN_ID=default
export OS_USER_DOMAIN_ID=default
export OS_PROJECT_NAME=admin
export OS_TENANT_NAME=admin
export OS_USERNAME=admin
export OS_PASSWORD={{ openstack_admin_password }}
export OS_AUTH_URL=http://{{ keystone_ip }}:35357/v3
export LC_ALL=C
export OS_IMAGE_API_VERSION=2
export OS_VOLUME_API_VERSION=2

[[ -f ./cirros-0.3.4-x86_64-disk.img ]] || wget http://download.cirros-cloud.net/0.3.4/cirros-0.3.4-x86_64-disk.img
if ! (glance image-list | fgrep -q "cirros-0.3.4-x86_64"); then
  glance image-create --name "cirros-0.3.4-x86_64" --file ./cirros-0.3.4-x86_64-disk.img --disk-format qcow2 --container-format bare --visibility public --progress
fi
